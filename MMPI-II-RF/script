// IMPORTANT: If the JavaScript is not working it is most probably because it relies on external libraries that are linked in the index.html file - however, if you don't have the permission to access them, it's better not to link them.

// Please keep in mind that JS files might also be obfuscated to prevent people from stealing the code and animations.

// However, all the HTML elements and CSS are there are you just need to access them using JS.

/**
 * MMPI-II-RF Questions
 * 
 * This file contains the 338 questions from the Minnesota Multiphasic Personality Inventory-2 Restructured Form.
 * These questions are presented in their standard order.
 */

const mmpiQuestions = [{
    "id": 2,
    "text": "I have a good appetite."
}, {
    "id": 3,
    "text": "I think I would like the work of a librarian."
}, {
    "id": 4,
    "text": "My daily life is full of things that keep me interested."
}, {
    "id": 5,
    "text": "At times I have very much wanted to leave home."
}, {
    "id": 6,
    "text": "I find it hard to keep my mind on a task or job."
}, {
    "id": 7,
    "text": "My mother is a good woman, or (if your mother is dead) my mother was a good woman."
}, {
    "id": 8,
    "text": "When I have a problem it helps to talk it over with someone."
}, {
    "id": 9,
    "text": "I often feel guilty because I pretend to feel more sorry about something than I really do."
}, {
    "id": 10,
    "text": "It takes a lot of argument to convince most people of the truth."
}, {
    "id": 11,
    "text": "l love to go to dances."
}, {
    "id": 12,
    "text": "I often feel I can read other people's minds."
}, {
    "id": 13,
    "text": "I sometimes keep on at a thing until others lose their patience with me."
}, {
    "id": 14,
    "text": "Evil spirits possess me at times."
}, {
    "id": 15,
    "text": "There seems to be a lump in my throat much of the time."
}, {
    "id": 16,
    "text": "At times I feel like swearing."
}, {
    "id": 17,
    "text": "I am a very sociable person."
}, {
    "id": 18,
    "text": "I feel weak all over much of the time."
}, {
    "id": 19,
    "text": "The members of my family and my close relatives get along quite well."
}, {
    "id": 20,
    "text": "I feel uneasy indoors."
}, {
    "id": 21,
    "text": "Sometimes when I was young I stole things."
}, {
    "id": 22,
    "text": "I wish I could be as happy as others seem to be."
}, {
    "id": 23,
    "text": "At times I feel like smashing things."
}, {
    "id": 24,
    "text": "I am easily downed in an argument."
}, {
    "id": 25,
    "text": "I am about as able to work as I ever was."
}, {
    "id": 26,
    "text": "When people do me a wrong, Ifeel I should pay them back  If I can , just for the principle of the thing."
}, {
    "id": 27,
    "text": "I have often lost out on things because I couldn't make up my mind soon enough"
}, {
    "id": 28,
    "text": "My hands and feet are usually warm enough."
}, {
    "id": 29,
    "text": "I am apt to take disappointments so keenly that I can't put them out of my mind"
}, {
    "id": 30,
    "text": "Most of the time I feel blue."
}, {
    "id": 31,
    "text": "I cannot understand what I read as well as I used to."
}, {
    "id": 32,
    "text": "I have had very peculiar and strange experiences."
}, {
    "id": 33,
    "text": "I have a cough most of the time."
}, {
    "id": 34,
    "text": "Ghosts or spirits can influence people for good or bad."
}, {
    "id": 35,
    "text": "I frequently have to fight against showing that I am bashful."
}, {
    "id": 36,
    "text": "I think a great many people exaggerate their misfortunes in order to gain the sympathy and help of others."
}, {
    "id": 37,
    "text": "My feelings are not easily hurt."
}, {
    "id": 38,
    "text": "I have never been in trouble because of my sex behavior."
}, {
    "id": 39,
    "text": "I have often had to take orders from someone who did not know as much as I did."
}, {
    "id": 40,
    "text": "Most anytime I would rather sit and daydream than do anything else."
}, {
    "id": 41,
    "text": "Sometimes I enjoy hurting persons I love."
}, {
    "id": 42,
    "text": "I would like to be a soldier."
}, {
    "id": 43,
    "text": "I am troubled by attacks of nausea and vomiting."
}, {
    "id": 44,
    "text": "I find it hard to make talk when I meet new people."
}, {
    "id": 45,
    "text": "I do not always tell the truth."
}, {
    "id": 46,
    "text": "When I am with people, I am bothered by hearing very strange things."
}, {
    "id": 47,
    "text": "I like to go to parties and other affairs where there is lots of loud tune."
}, {
    "id": 48,
    "text": "I am certainly lacking in self-confidence."
}, {
    "id": 49,
    "text": "I have enjoyed using marijuana."
}, {
    "id": 50,
    "text": "I would like to be a singer."
}, {
    "id": 51,
    "text": "I have been afraid of things or people that I knew could not hurt me."
}, {
    "id": 52,
    "text": "I am very seldom troubled by constipation."
}, {
    "id": 53,
    "text": "At times I am all full of energy."
}, {
    "id": 54,
    "text": "Lightning is one of my fears."
}, {
    "id": 55,
    "text": "I think most people would lie to get ahead."
}, {
    "id": 56,
    "text": "I get anxious and upset when I have to make a short trip away from home."
}, {
    "id": 57,
    "text": "I enjoy social gatherings just to be with people."
}, {
    "id": 58,
    "text": "Some of my family have habits that bother and annoy me very much."
}, {
    "id": 59,
    "text": "My memory seems to be all right."
}, {
    "id": 60,
    "text": "I frequently find it necessary to stand up for what I think is right."
}, {
    "id": 61,
    "text": "I haye never done anything dangerous for the thrill of it."
}, {
    "id": 62,
    "text": "I do many things which I regret afterwards (I regret things more than others seem to)."
}, {
    "id": 63,
    "text": "I have often felt that strangers were looking at me critically."
}, {
    "id": 64,
    "text": "I am an important person."
}, {
    "id": 65,
    "text": "I am almost never bothered by pains over my heart or in my chest."
}, {
    "id": 66,
    "text": "In school I was sometimes sent to the principal for bad behavior."
}, {
    "id": 67,
    "text": "I dislike having people around me."
}, {
    "id": 68,
    "text": "I usually have to stop and think before I act even in small matters."
}, {
    "id": 69,
    "text": "My hands have not become clumsy or awkward."
}, {
    "id": 70,
    "text": "I do not read every editorial in the newspaper every day."
}, {
    "id": 71,
    "text": "I believe I am being plotted against."
}, {
    "id": 72,
    "text": "At times my thoughts have raced ahead faster than I could speak them."
}, {
    "id": 73,
    "text": "I believe I am no more nervous than most others."
}, {
    "id": 74,
    "text": "Much of the time I feel as if I have done something wrong or evil."
}, {
    "id": 75,
    "text": "I think I would like the kind of work a forest ranger does."
}, {
    "id": 76,
    "text": "I am bothered by an upset stomach several times a week."
}, {
    "id": 77,
    "text": "I am so touchy on some subjects that I can't talk about them."
}, {
    "id": 78,
    "text": "My hearing is apparently as good as that of most people."
}, {
    "id": 79,
    "text": "i have nightmares every few nights."
}, {
    "id": 80,
    "text": "I have very few quarrels with members of my family."
}, {
    "id": 81,
    "text": "At times I have fits of laughing and crying that I cannot control."
}, {
    "id": 82,
    "text": "I do not have a great fear of snakes."
}, {
    "id": 83,
    "text": "I usually feel that life is worthwhile."
}, {
    "id": 84,
    "text": "At times I feel like picking a fist fight with someone."
}, {
    "id": 85,
    "text": "I have never seen a vision."
}, {
    "id": 86,
    "text": "I can express my true feelings only when I drink."
}, {
    "id": 87,
    "text": "Most people are honest chiefly because they are afraid of being caught."
}, {
    "id": 88,
    "text": "I hardly ever feel pain in the back of my neck."
}, {
    "id": 89,
    "text": "I certainly feel useless at times."
}, {
    "id": 90,
    "text": "I am afraid of finding myself in a closet or small closed place."
}, {
    "id": 91,
    "text": "I am easily embarrassed."
}, {
    "id": 92,
    "text": "I believe I am being followed."
}, {
    "id": 93,
    "text": "I have recently considered killing myself."
}, {
    "id": 94,
    "text": "I do not mind meeting strangers."
}, {
    "id": 95,
    "text": "Once in a while I put off until tomorrow what I ought to do today."
}, {
    "id": 96,
    "text": "My parents often objected to the kind of people I went around with."
}, {
    "id": 97,
    "text": "I like to know some important people because it makes me feel important."
}, {
    "id": 98,
    "text": "I love my father, or (if your father is dead) I loved my father."
}, {
    "id": 99,
    "text": "Most people will use somewhat unfair means to gain profit or an advantage rather than to lose it."
}, {
    "id": 100,
    "text": "I like poetry."
}, {
    "id": 101,
    "text": "Much of the time my head seems to hurt all over."
}, {
    "id": 102,
    "text": "I seem to be about as capable and smart as most others around me."
}, {
    "id": 103,
    "text": "Once in a while I feel hate toward members of my family whom I usually love."
}, {
    "id": 104,
    "text": "I strongly defend my own opinions as a rule."
}, {
    "id": 105,
    "text": "I am happy most of the time."
}, {
    "id": 106,
    "text": "I have had periods in which I carried on activities without knowing later what I had been doing."
}, {
    "id": 107,
    "text": "I like to talk about sex."
}, {
    "id": 108,
    "text": "I have several times given up doing a thing because I thought too little of my ability."
}, {
    "id": 109,
    "text": "I enjoy the excitement of a crowd."
}, {
    "id": 110,
    "text": "I feel that I have often been punished without cause."
}, {
    "id": 111,
    "text": "I think I would like the work of a building contractor."
}, {
    "id": 112,
    "text": "I am apt to pass up something I want to do because others feel that I am not going about it in the right way."
}, {
    "id": 113,
    "text": "I have little or no trouble with my muscles twitching or jumping."
}, {
    "id": 114,
    "text": "I wish I were not so shy."
}, {
    "id": 115,
    "text": "I am not afraid of fire."
}, {
    "id": 116,
    "text": "I am inclined to take things hard."
}, {
    "id": 117,
    "text": "There is something wrong with my mind."
}, {
    "id": 118,
    "text": "l like to flirt."
}, {
    "id": 119,
    "text": "I easily become impatient with people."
}, {
    "id": 120,
    "text": "Most of the time I wish I were dead."
}, {
    "id": 121,
    "text": "It is safer to trust nobody."
}, {
    "id": 122,
    "text": "I have had attacks in which I could not control my movements or speech but in which I knew what was going on around me."
}, {
    "id": 123,
    "text": "I worry quite a bit over possible misfortunes."
}, {
    "id": 124,
    "text": "I have never been in love with anyone."
}, {
    "id": 125,
    "text": "My speech is the same as always (not faster or slower, no slurring or hoarseness)."
}, {
    "id": 126,
    "text": "I Iiked school."
}, {
    "id": 127,
    "text": "I get angry sometimes."
}, {
    "id": 128,
    "text": "I am not afraid to handie money."
}, {
    "id": 129,
    "text": "Someone has been trying to poison me."
}, {
    "id": 130,
    "text": "I brood a great deal."
}, {
    "id": 131,
    "text": "When I get bored I like to stir up some excitement."
}, {
    "id": 132,
    "text": "Often I cross the street in order not to meet someone I see."
}, {
    "id": 133,
    "text": "Everything tastes the same."
}, {
    "id": 134,
    "text": "I am not easily angered."
}, {
    "id": 135,
    "text": "It bothers me greatly to think of making changes in my life."
}, {
    "id": 136,
    "text": "I cannot keep my mind on one thing."
}, {
    "id": 137,
    "text": "There seems to be a fullness in my head or nose most of the time."
}, {
    "id": 138,
    "text": "My parents and family find more fault with me than they should."
}, {
    "id": 139,
    "text": "I often hear voices without knowing where they come from."
}, {
    "id": 140,
    "text": "I enjoy many different kinds of play and recreation."
}, {
    "id": 141,
    "text": "I have used alcohol excessively."
}, {
    "id": 142,
    "text": "Most people make friends because friends are likely to be useful to them."
}, {
    "id": 143,
    "text": "I have at times stood in the way of people who were trying to do something, not because it amounted to much but because of the principie of the thing."
}, {
    "id": 144,
    "text": "I have difficulty in starting to do things."
}, {
    "id": 145,
    "text": "I would like to be a florist."
}, {
    "id": 146,
    "text": "Almost every day something happens to frighten me."
}, {
    "id": 147,
    "text": "I Iike to let people know where I stand on things."
}, {
    "id": 148,
    "text": "I very much like hunting."
}, {
    "id": 149,
    "text": "Sometimes some unimportant thought will run through my mind and bother me fordays."
}, {
    "id": 150,
    "text": "Someone has been trying to rob me."
}, {
    "id": 151,
    "text": "A windstorm terrifies me."
}, {
    "id": 152,
    "text": "I feel like giving up quickly when things go wrong."
}, {
    "id": 153,
    "text": "My worries seem to disappear when I get into a crowd of lively friends."
}, {
    "id": 154,
    "text": "My table manners are not quite as good at home as when I am out in company."
}, {
    "id": 155,
    "text": "I get mad easily and then get over it soon."
}, {
    "id": 156,
    "text": "I can remember \"playing sick\" to get out of something."
}, {
    "id": 157,
    "text": "Anyone who is able and willing to work hard has a good chance of succeeding."
}, {
    "id": 158,
    "text": "Life is a strain for me much of the time."
}, {
    "id": 159,
    "text": "I have had blank spells in which my activities were interrupted and I did not know what was going on around me."
}, {
    "id": 160,
    "text": "At times I feel that I can make up my mind with unusually great ease."
}, {
    "id": 161,
    "text": "Bad words, often terrible words, come into my mind and I cannot get rid of them."
}, {
    "id": 162,
    "text": "I seldom or never have dizzy spells."
}, {
    "id": 163,
    "text": "I wake up fresh and rested most mornings."
}, {
    "id": 164,
    "text": "Lately I have thought a lot about killing myself."
}, {
    "id": 165,
    "text": "I am often afraid of the dark."
}, {
    "id": 166,
    "text": "Sometimos without any reason or even when things are going wrong I feel excitedly happy, \"on top of the world.\""
}, {
    "id": 167,
    "text": "It makes me nervous to have to wait."
}, {
    "id": 168,
    "text": "There are persons who are trying to steal my thoughts and ideas."
}, {
    "id": 169,
    "text": "The future seems hopeless to me."
}, {
    "id": 170,
    "text": "I can sleep during the day but not at night."
}, {
    "id": 171,
    "text": "I think nearly anyone would tell a lie to keep out of trouble."
}, {
    "id": 172,
    "text": "Often, even though everything is going fine for me, I feel that I don't care about anything."
}, {
    "id": 173,
    "text": "I got many beatings when I was a child."
}, {
    "id": 174,
    "text": "During the past few years I have been well most of the time."
}, {
    "id": 175,
    "text": "I am never happier than when alone."
}, {
    "id": 176,
    "text": "Often I feel as if there is a tight band around my head."
}, {
    "id": 177,
    "text": "I am likely not to speak to people until they speak to me."
}, {
    "id": 178,
    "text": "It would be better if almost all laws were thrown away."
}, {
    "id": 179,
    "text": "SometiMes my voice leaves me or changes even though I have no cold."
}, {
    "id": 180,
    "text": "The things that some of my family have done have frightened me."
}, {
    "id": 181,
    "text": "Once a week or oftener I becorne very excited."
}, {
    "id": 182,
    "text": "I am entirely self-confident."
}, {
    "id": 183,
    "text": "I would rather win than lose in a game."
}, {
    "id": 184,
    "text": "I have no fear of water."
}, {
    "id": 185,
    "text": "Most people inwardly dislike putting themselves out to help other people."
}, {
    "id": 186,
    "text": "I have never had a fit or convulsion."
}, {
    "id": 187,
    "text": "I have sometimes felt that difficulties were pilling up so high that I could not overcorne them."
}, {
    "id": 188,
    "text": "If I were a reporter I would very much hike to report sporting news."
}, {
    "id": 189,
    "text": "I have very few headaches."
}, {
    "id": 190,
    "text": "I have never been in trouble with the Iaw."
}, {
    "id": 191,
    "text": "In walking I am very careful to step over sidewalk cracks."
}, {
    "id": 192,
    "text": "After a bad day, I usually need a few drinks to relax."
}, {
    "id": 193,
    "text": "At times I have been so entertained by the cleverness of sorne criminals that I have hoped they would get away with it."
}, {
    "id": 194,
    "text": "I am sure I am being talked about."
}, {
    "id": 195,
    "text": "Something exciting will almost always pull me out of it when I am feelling low."
}, {
    "id": 196,
    "text": "I like dramatics."
}, {
    "id": 197,
    "text": "I am usually very direct with people I am trying to correct or improve."
}, {
    "id": 198,
    "text": "I shrink from facing a crisis or difficulty."
}, {
    "id": 199,
    "text": "Peculiar odors come to me at times."
}, {
    "id": 200,
    "text": "I have more trouble concentrating than others seem to have."
}, {
    "id": 201,
    "text": "I like parties and socials."
}, {
    "id": 202,
    "text": "I have never felt better in my life than I do now."
}, {
    "id": 203,
    "text": "My soul sometimes leaves my body."
}, {
    "id": 204,
    "text": "Even when I am with people I feel lonely much of the time."
}, {
    "id": 205,
    "text": "When I was young I often did not go to school even when I should have gone."
}, {
    "id": 206,
    "text": "I wish I could get over worrying about things I have said that may have injured other people's feelings."
}, {
    "id": 207,
    "text": "I have periods in which I feel unusually cheerful without any special reason."
}, {
    "id": 208,
    "text": "I am afraid of using a knife or anything very sharp or pointed."
}, {
    "id": 209,
    "text": "I have certainly had more than my share of things to worry about."
}, {
    "id": 210,
    "text": "I am troubled by discomfort in the pit of my stomach every few days or oftener."
}, {
    "id": 211,
    "text": "I do not like everyone I know."
}, {
    "id": 212,
    "text": "I have no enemies who really wish to harm me."
}, {
    "id": 213,
    "text": "People generally demand more respect for their own rights than they are willing to allow for others."
}, {
    "id": 214,
    "text": "Although I am not happy with my life, there is nothing I can do about it now."
}, {
    "id": 215,
    "text": "I often have serious disagreements with people who are close to me."
}, {
    "id": 216,
    "text": "At times I hear so well it bothers me."
}, {
    "id": 217,
    "text": "I very seldom have spells of the blues."
}, {
    "id": 218,
    "text": "At times it has been impossible for me to keep from stealing or shoplifting something."
}, {
    "id": 219,
    "text": "Sometimes I become so excited that I find it hard to get to sleep."
}, {
    "id": 220,
    "text": "I have no fear of spiders."
}, {
    "id": 221,
    "text": "I believe in law enforcement."
}, {
    "id": 222,
    "text": "I seem to make friends about as quickly as others do."
}, {
    "id": 223,
    "text": "I was suspended from school one or more times for bad behavior."
}, {
    "id": 224,
    "text": "I always have too little time to get things done."
}, {
    "id": 225,
    "text": "I have been told that I walk during sleep."
}, {
    "id": 226,
    "text": "I would like to be an auto racer."
}, {
    "id": 227,
    "text": "I have had no difficulty in keeping my balance in walking."
}, {
    "id": 227,
    "text": "228.I feel anxiety about something or someone almost all the time."
}, {
    "id": 228,
    "text": "229.I am apt to pass up something I want to do when others feel that it isn't worth doing."
}, {
    "id": 230,
    "text": "I have a great deal of stomach trouble."
}, {
    "id": 231,
    "text": "I can easily make other people afraid of me, and sometimes do for the tun of it."
}, {
    "id": 232,
    "text": "At times I think I am no good at all."
}, {
    "id": 233,
    "text": "People say insulting and vulgar things about me."
}, {
    "id": 234,
    "text": "I am not feelling much pressure or stress these days."
}, {
    "id": 235,
    "text": "I am bothered by people outside, on the streets, in stores, etc., watching me."
}, {
    "id": 236,
    "text": "I don't like hearing other people give their opinions about life."
}, {
    "id": 237,
    "text": "Except by doctor's orders I never take drugs or sleeping pills."
}, {
    "id": 238,
    "text": "When a man is with a woman he is usually thinking about things related to her sex."
}, {
    "id": 239,
    "text": "If given the chance I would make a good leader of people."
}, {
    "id": 240,
    "text": "I often feel as if things are not real."
}, {
    "id": 241,
    "text": "I gossip a little at times."
}, {
    "id": 242,
    "text": "The top of my head sometimes feels tender."
}, {
    "id": 243,
    "text": "Dirt frightens or disgusts me."
}, {
    "id": 244,
    "text": "If given the chance I could do some things that would be of great benefit to the world."
}, {
    "id": 245,
    "text": "If I were a reporter I would very much like to report news of the theater."
}, {
    "id": 246,
    "text": "I usually expect to succeed in things I do."
}, {
    "id": 247,
    "text": "I feel tired a good deal of the time."
}, {
    "id": 248,
    "text": "I am often said to be hot headed."
}, {
    "id": 249,
    "text": "In school I found it very hard to talk in front of the class."
}, {
    "id": 250,
    "text": "I am often sorry because I am so irritable and grouchy."
}, {
    "id": 251,
    "text": "No one knows it but I have tried to kill myself."
}, {
    "id": 252,
    "text": "Someone has control over my mind."
}, {
    "id": 253,
    "text": "In school my marks in classroom behavior were quite regularly bad."
}, {
    "id": 254,
    "text": "I hardly ever notice my heart pounding and I am seldom short of breath."
}, {
    "id": 255,
    "text": "It does not bother me particularly to see animals suffer."
}, {
    "id": 256,
    "text": "I have often met people who were supposed to be experts who were no better than I."
}, {
    "id": 257,
    "text": "I have strange and peculiar thoughts."
}, {
    "id": 258,
    "text": "I dread the thought of an earthquake."
}, {
    "id": 258,
    "text": "Scoring guide: True=1;  False=2;  No answer=3"
}, {
    "id": 259,
    "text": "I like repairing a door latch."
}, {
    "id": 260,
    "text": "I have frequently worked under people who seem to have things arranged so that they get credit for good work but are able to pass off mistakes onto those under them."
}, {
    "id": 261,
    "text": "I sometimes feel that I am about to go to pieces."
}, {
    "id": 262,
    "text": "I am in just as good physical health as most of my friends."
}, {
    "id": 263,
    "text": "I must admit that I have at times been worried beyond reason over something that really did not matter."
}, {
    "id": 264,
    "text": "Someone has it in for me."
}, {
    "id": 265,
    "text": "I have few or no pains."
}, {
    "id": 266,
    "text": "I have a drug or alcohol problem."
}, {
    "id": 267,
    "text": "I have had periods when I felt so full of pep that sleep did not seem necessary for days at a time."
}, {
    "id": 268,
    "text": "I never worry about my Iooks."
}, {
    "id": 269,
    "text": "When things get really bad, I know I can count on my family for help."
}, {
    "id": 270,
    "text": "At one or more times in my life I felt that someone was making me do things by hypnotizing me."
}, {
    "id": 271,
    "text": "It makes me angry to have people hurry me."
}, {
    "id": 272,
    "text": "I have no trouble swallowing."
}, {
    "id": 273,
    "text": "I hear strange things when I am alone."
}, {
    "id": 274,
    "text": "I usually have a hard time deciding what to do."
}, {
    "id": 275,
    "text": "Several times a week I feel as if something dreadful is about to happen."
}, {
    "id": 276,
    "text": "When people do something that makes me angry, I let them know how I feel about it."
}, {
    "id": 277,
    "text": "I frequently notice my hand shakes when I try to do something."
}, {
    "id": 278,
    "text": "Whenever possible I avoid being in a crowd."
}, {
    "id": 279,
    "text": "Most men are unfaithful to their wives now and then."
}, {
    "id": 280,
    "text": "Often I get confused and forget what I want to say."
}, {
    "id": 281,
    "text": "My people treat me more like a child than a grown-up."
}, {
    "id": 282,
    "text": "282: My main goals in life are within my reach."
}, {
    "id": 283,
    "text": "Talking over problems and worries with sorneone is often more helptul than taking drugs or medicine."
}, {
    "id": 284,
    "text": "I am afraid of being alone in a wide-open place."
}, {
    "id": 285,
    "text": "At times I can't seem to stop talking."
}, {
    "id": 286,
    "text": "I am not afraid \u00f3f mice."
}, {
    "id": 287,
    "text": "Someone has been trying to influence my mind."
}, {
    "id": 288,
    "text": "I often feel that l'm not as good as other people."
}, {
    "id": 289,
    "text": "I have often been frightened in the middle of the night."
}, {
    "id": 290,
    "text": "I do not often notice my ears ringing or buzzing."
}, {
    "id": 291,
    "text": "291.I am never happier than when I am by myself."
}, {
    "id": 292,
    "text": "I like to keep people guessing what I'm going to do next."
}, {
    "id": 293,
    "text": "I am usually calm and not easily upset."
}, {
    "id": 294,
    "text": "I see things or animals or people around me that others do not see."
}, {
    "id": 295,
    "text": "I have no dread of going into a room by myself where other people have already gathered and are talking."
}, {
    "id": 296,
    "text": "I would like to be a journalist."
}, {
    "id": 297,
    "text": "Once a week or more I get high or drunk."
}, {
    "id": 298,
    "text": "Sometimes in elections I vote for people about whom I know very little."
}, {
    "id": 299,
    "text": "I feel helpless when  have to make some important decisions."
}, {
    "id": 300,
    "text": "I really like playinG rough sports (such as football or soccer)"
}, {
    "id": 301,
    "text": " I have numbness in one or more places on my skin."
}, {
    "id": 302,
    "text": "302.I like making decisions and assigning jobs to others."
}, {
    "id": 303,
    "text": "I often become very irritable when people interrupt my work."
}, {
    "id": 304,
    "text": "In most marriages one or both partners are unhappy."
}, {
    "id": 305,
    "text": "I would certainly enjoy beating criminals at their own game."
}, {
    "id": 306,
    "text": "I forget where I leave things."
}, {
    "id": 307,
    "text": "Terrible thoughts about my family come to me at times."
}, {
    "id": 308,
    "text": "My neck spots with red often."
}, {
    "id": 309,
    "text": "I worry a great deal over money."
}, {
    "id": 310,
    "text": "People are not very kind to me."
}, {
    "id": 311,
    "text": "Sometimes I am sure that other people can telI what I am thinking."
}, {
    "id": 312,
    "text": "I have gotten angry and broken furniture or dishes when I was drinking."
}, {
    "id": 313,
    "text": "I have never been paralyzed or had any unusual weakness of any of my muscles."
}, {
    "id": 314,
    "text": "I hate my whole family."
}, {
    "id": 315,
    "text": "I am so sick of what I have to do every day that I just want to get out of it alI."
}, {
    "id": 316,
    "text": "I have at times had to be rough with people who were rude or annoying."
}, {
    "id": 317,
    "text": "I can't go into a dark room alone even in my own home."
}, {
    "id": 318,
    "text": "Sometimes I get so angry and upset I don't know what comes over me."
}, {
    "id": 319,
    "text": "I sometimes find it hard to stick up for my rights because I am so reserved."
}, {
    "id": 320,
    "text": "I am made nervous by certain animals."
}, {
    "id": 321,
    "text": "I like to drive a hard bargain."
}, {
    "id": 322,
    "text": "Criticism or scolding hurts me terribly."
}, {
    "id": 323,
    "text": "When I am sad, visiting with friends can always pull me out of it."
}, {
    "id": 324,
    "text": "Having to make important decisions makes me nervous."
}, {
    "id": 325,
    "text": "Once in a while I Iaugh at a dirty joke."
}, {
    "id": 326,
    "text": "Most married couples don't show much affection for each other."
}, {
    "id": 327,
    "text": "I am often inclined to go out of my way to win a point with someone who has opposed me."
}, {
    "id": 328,
    "text": "If I get upset I'm sure to get a headache."
}, {
    "id": 329,
    "text": "I've been so angry at times that I've hurt someone in a physical fight."
}, {
    "id": 330,
    "text": "I sometimes seem to hear my thoughts being spoken out loud."
}, {
    "id": 331,
    "text": "When my life gets difficult, it makes me want to just give up."
}, {
    "id": 332,
    "text": "It people had not had it in for me, I would have been much more successful."
}, {
    "id": 333,
    "text": "I do not tire quickly."
}, {
    "id": 334,
    "text": "My thoughts these days turn more and more to death and the lite hereafter."
}, {
    "id": 335,
    "text": "I get angry with myself for giving in to other people so much."
}, {
    "id": 336,
    "text": "I recognize several faults in myself that I wilI not be able to change."
}, {
    "id": 337,
    "text": "I have become so angry with someone that I have felt as it I would explode."
}, {
    "id": 338,
    "text": "I frequently find myself worrying about something."
}];

// Export the questions for use in other modules
if (typeof module !== 'undefined' && module.exports) {
    module.exports = {
        mmpiQuestions
    };
}/**
 * MMPI-II-RF Scoring Logic
 * 
 * This file implements the scoring logic for the MMPI-II-RF assessment based on
 * the documentation extracted from the "Comprehensive Logic and Formulas for Spreadsheet Scales.zip"
 */

/**
 * Scale definitions with metadata
 * Based on the item-to-scale mapping documentation
 */
const mmpiScales = {
    // Validity Scales
    "VRIN-r": {
        name: "Variable Response Inconsistency - Revised",
        description: "Measures inconsistent responses to similar item pairs",
        type: "validity",
        scoringType: "pair_comparison",
        itemPairs: [{
                pair: [3, 39],
                type: "similar",
                scoreIf: "different"
            }, {
                pair: [6, 111],
                type: "similar",
                scoreIf: "different"
            }, {
                pair: [6, 196],
                type: "similar",
                scoreIf: "different"
            }, {
                pair: [9, 56],
                type: "similar",
                scoreIf: "different"
            }, {
                pair: [10, 196],
                type: "similar",
                scoreIf: "different"
            }, {
                pair: [12, 166],
                type: "similar",
                scoreIf: "different"
            }, {
                pair: [23, 163],
                type: "similar",
                scoreIf: "different"
            }, {
                pair: [27, 87],
                type: "similar",
                scoreIf: "different"
            }, {
                pair: [31, 54],
                type: "similar",
                scoreIf: "different"
            }, {
                pair: [32, 316],
                type: "similar",
                scoreIf: "different"
            }, {
                pair: [73, 277],
                type: "similar",
                scoreIf: "different"
            }, {
                pair: [81, 142],
                type: "similar",
                scoreIf: "different"
            }, {
                pair: [83, 288],
                type: "similar",
                scoreIf: "different"
            }, {
                pair: [84, 105],
                type: "similar",
                scoreIf: "different"
            }, {
                pair: [99, 314],
                type: "similar",
                scoreIf: "different"
            }
            // Note: This is a subset of the pairs for demonstration
            // The complete list would include all 53 item pairs
        ]
    },
    "TRIN-r": {
        name: "True Response Inconsistency - Revised",
        description: "Measures tendency to respond true or false inconsistently",
        type: "validity",
        scoringType: "pair_comparison",
        itemPairs: [{
                pair: [1, 143],
                type: "opposite",
                scoreIf: "both_true"
            }, {
                pair: [23, 107],
                type: "opposite",
                scoreIf: "both_true"
            }, {
                pair: [31, 67],
                type: "opposite",
                scoreIf: "both_true"
            }, {
                pair: [49, 167],
                type: "opposite",
                scoreIf: "both_true"
            }, {
                pair: [83, 101],
                type: "opposite",
                scoreIf: "both_true"
            }, {
                pair: [95, 158],
                type: "opposite",
                scoreIf: "both_true"
            }, {
                pair: [99, 218],
                type: "opposite",
                scoreIf: "both_true"
            }, {
                pair: [137, 285],
                type: "opposite",
                scoreIf: "both_true"
            }, {
                pair: [159, 280],
                type: "opposite",
                scoreIf: "both_true"
            }, {
                pair: [169, 177],
                type: "opposite",
                scoreIf: "both_false"
            }
            // Note: This is a subset of the pairs for demonstration
        ]
    },
    "F-r": {
        name: "Infrequent Responses - Revised",
        description: "Identifies unusual or infrequent responses",
        type: "validity",
        items: [{
                id: 14,
                key: true
            }, {
                id: 17,
                key: false
            }, {
                id: 20,
                key: true
            }, {
                id: 21,
                key: true
            }, {
                id: 25,
                key: true
            }, {
                id: 32,
                key: true
            }, {
                id: 34,
                key: true
            }, {
                id: 35,
                key: true
            }, {
                id: 44,
                key: true
            }, {
                id: 48,
                key: true
            }
            // Note: This is a subset of the items for demonstration
        ]
    },

    // Higher-Order (H-O) Scales
    "EID": {
        name: "Emotional/Internalizing Dysfunction",
        description: "Overall emotional and internalizing problems",
        type: "higher-order",
        items: [
            // Items would be listed here based on the documentation
        ]
    },
    "THD": {
        name: "Thought Dysfunction",
        description: "Problems associated with disordered thinking",
        type: "higher-order",
        items: [
            // Items would be listed here based on the documentation
        ]
    },
    "BXD": {
        name: "Behavioral/Externalizing Dysfunction",
        description: "Acting-out or externalizing behaviors",
        type: "higher-order",
        items: [
            // Items would be listed here based on the documentation
        ]
    },

    // Restructured Clinical (RC) Scales
    "RCd": {
        name: "Demoralization",
        description: "General unhappiness and dissatisfaction",
        type: "clinical",
        items: [{
                id: 15,
                key: true
            }, {
                id: 29,
                key: true
            }, {
                id: 37,
                key: true
            }, {
                id: 49,
                key: true
            }, {
                id: 71,
                key: true
            }, {
                id: 89,
                key: true
            }, {
                id: 98,
                key: true
            }, {
                id: 99,
                key: true
            }, {
                id: 109,
                key: true
            }, {
                id: 134,
                key: true
            }
            // Note: This is a subset of the items for demonstration
        ]
    },
    "RC1": {
        name: "Somatic Complaints",
        description: "Diffuse physical health complaints",
        type: "clinical",
        items: [{
                id: 1,
                key: true
            }, {
                id: 3,
                key: true
            }, {
                id: 11,
                key: true
            }, {
                id: 28,
                key: true
            }, {
                id: 36,
                key: true
            }, {
                id: 40,
                key: true
            }, {
                id: 55,
                key: true
            }, {
                id: 65,
                key: true
            }, {
                id: 75,
                key: true
            }, {
                id: 118,
                key: true
            }
            // Note: This is a subset of the items for demonstration
        ]
    }
    // Additional scales would be defined here
};

/**
 * Calculates raw scores for all MMPI-II-RF scales based on responses
 * @param {Object} responses - Object with question IDs as keys and boolean responses as values
 * @returns {Object} - Object with scale IDs as keys and raw scores as values
 */
function calculateRawScores(responses) {
    const scores = {};

    // Process each scale
    for (const [scaleId, scale] of Object.entries(mmpiScales)) {
        let rawScore = 0;

        // Different scoring logic based on scale type
        if (scale.scoringType === "pair_comparison") {
            // For VRIN-r and TRIN-r scales
            rawScore = calculatePairComparisonScore(responses, scale);
        } else {
            // For standard scales
            rawScore = calculateStandardScore(responses, scale);
        }

        scores[scaleId] = rawScore;
    }

    return scores;
}

/**
 * Calculates score for pair comparison scales like VRIN-r and TRIN-r
 * @param {Object} responses - Object with question IDs as keys and boolean responses as values
 * @param {Object} scale - Scale definition object
 * @returns {number} - Raw score for the scale
 */
function calculatePairComparisonScore(responses, scale) {
    let score = 0;

    for (const pair of scale.itemPairs) {
        const [item1, item2] = pair.pair;
        const response1 = responses[item1];
        const response2 = responses[item2];

        // Skip if either response is missing
        if (response1 === undefined || response2 === undefined) {
            continue;
        }

        if (scale.id === "VRIN-r") {
            // For VRIN-r
            if (pair.type === "similar" && response1 !== response2) {
                score++;
            } else if (pair.type === "opposite" && response1 === response2) {
                score++;
            }
        } else if (scale.id === "TRIN-r") {
            // For TRIN-r
            if (pair.scoreIf === "both_true" && response1 === true && response2 === true) {
                score++;
            } else if (pair.scoreIf === "both_false" && response1 === false && response2 === false) {
                score++;
            }
        }
    }

    return score;
}

/**
 * Calculates score for standard scales
 * @param {Object} responses - Object with question IDs as keys and boolean responses as values
 * @param {Object} scale - Scale definition object
 * @returns {number} - Raw score for the scale
 */
function calculateStandardScore(responses, scale) {
    let score = 0;

    if (!scale.items) {
        return 0; // Return 0 if no items are defined for the scale
    }

    for (const item of scale.items) {
        const response = responses[item.id];

        // Skip if response is missing
        if (response === undefined) {
            continue;
        }

        // Score 1 point if response matches the keyed direction
        if (response === item.key) {
            score++;
        }
    }

    return score;
}

/**
 * Converts raw scores to T-scores using normative data
 * @param {Object} rawScores - Object with scale IDs as keys and raw scores as values
 * @param {string} normGroup - Normative group to use (e.g., "male", "female")
 * @returns {Object} - Object with scale IDs as keys and T-scores as values
 */
function convertToTScores(rawScores, normGroup) {
    // In a real implementation, this would use normative data tables
    // For this demonstration, we'll use a simplified linear transformation
    const tScores = {};

    for (const [scaleId, rawScore] of Object.entries(rawScores)) {
        // Simple linear transformation (this is just a placeholder)
        // In reality, this would use proper normative data tables
        const tScore = 50 + (rawScore * 10 / 15); // Simplified formula
        tScores[scaleId] = Math.round(tScore);
    }

    return tScores;
}

/**
 * Interprets T-scores based on clinical cutoffs
 * @param {Object} tScores - Object with scale IDs as keys and T-scores as values
 * @returns {Object} - Object with scale IDs as keys and interpretation objects as values
 */
function interpretScores(tScores) {
    const interpretations = {};

    for (const [scaleId, tScore] of Object.entries(tScores)) {
        let level, description;

        // General interpretation guidelines
        if (tScore < 40) {
            level = "Low";
            description = "Below average, potentially indicating absence of the measured trait or problem.";
        } else if (tScore >= 40 && tScore < 55) {
            level = "Average";
            description = "Within normal limits, typical of the general population.";
        } else if (tScore >= 55 && tScore < 65) {
            level = "Moderately Elevated";
            description = "Somewhat higher than average, may indicate mild issues in this area.";
        } else if (tScore >= 65 && tScore < 75) {
            level = "Elevated";
            description = "Significantly higher than average, suggesting notable problems in this area.";
        } else {
            level = "Very Elevated";
            description = "Much higher than average, indicating potential serious problems in this area.";
        }

        // Store the interpretation
        interpretations[scaleId] = {
            level,
            description,
            score: tScore
        };
    }

    return interpretations;
}

/**
 * Generates a summary report based on score interpretations
 * @param {Object} interpretations - Object with scale IDs as keys and interpretation objects as values
 * @returns {string} - Summary report text
 */
function generateSummaryReport(interpretations) {
    // This would be a more complex function in a real implementation
    // For now, we'll just create a simple summary

    let summary = "## Assessment Summary\n\n";

    // Check validity scales first
    const validityScales = ["VRIN-r", "TRIN-r", "F-r"];
    let validityIssues = false;

    summary += "### Validity Assessment\n\n";

    for (const scale of validityScales) {
        if (interpretations[scale] && interpretations[scale].level !== "Average") {
            validityIssues = true;
            summary += `- **${scale}**: ${interpretations[scale].level} (T-score: ${interpretations[scale].score})\n`;
        }
    }

    if (validityIssues) {
        summary += "\nThere may be issues with the validity of this assessment. The results should be interpreted with caution.\n\n";
    } else {
        summary += "\nNo significant validity issues detected. The results are likely to be an accurate representation of the individual's current functioning.\n\n";
    }

    // Summarize clinical scales
    summary += "### Clinical Profile\n\n";

    // Higher-Order Scales
    const hoScales = ["EID", "THD", "BXD"];
    summary += "**Higher-Order Scales:**\n\n";

    for (const scale of hoScales) {
        if (interpretations[scale]) {
            summary += `- **${mmpiScales[scale].name}**: ${interpretations[scale].level} (T-score: ${interpretations[scale].score})\n`;
        }
    }

    // RC Scales
    const rcScales = ["RCd", "RC1", "RC2", "RC3", "RC4", "RC6", "RC7", "RC8", "RC9"];
    summary += "\n**Restructured Clinical Scales:**\n\n";

    for (const scale of rcScales) {
        if (interpretations[scale]) {
            summary += `- **${mmpiScales[scale].name}**: ${interpretations[scale].level} (T-score: ${interpretations[scale].score})\n`;
        }
    }

    // Overall impression
    summary += "\n### Overall Impression\n\n";
    summary += "This section would contain an integrated interpretation of the assessment results, taking into account patterns across scales and potential clinical implications.\n\n";
    summary += "Note: This is an automated interpretation and should be reviewed by a qualified mental health professional.\n";

    return summary;
}

// Export the functions for use in other modules
if (typeof module !== 'undefined' && module.exports) {
    module.exports = {
        mmpiScales,
        calculateRawScores,
        convertToTScores,
        interpretScores,
        generateSummaryReport
    };
}/**
 * MMPI-II-RF Local Storage Module
 * 
 * This module handles saving and retrieving assessment data using the browser's localStorage API.
 * It provides functionality for:
 * - Saving responses as the user progresses through the assessment
 * - Retrieving saved responses to resume an assessment
 * - Saving final assessment results
 * - Managing multiple saved assessments
 */

/**
 * Storage keys
 */
const STORAGE_KEYS = {
    CURRENT_ASSESSMENT: 'mmpi_current_assessment',
    SAVED_ASSESSMENTS: 'mmpi_saved_assessments',
    SETTINGS: 'mmpi_settings'
};

/**
 * Saves the current state of an in-progress assessment
 * @param {Object} assessmentData - Object containing assessment state
 * @param {Object} assessmentData.responses - User responses (question ID -> boolean)
 * @param {number} assessmentData.currentQuestion - Current question index
 * @param {Date} assessmentData.lastUpdated - Timestamp of last update
 * @returns {boolean} - Success status
 */
function saveCurrentAssessment(assessmentData) {
    try {
        // Add timestamp if not provided
        if (!assessmentData.lastUpdated) {
            assessmentData.lastUpdated = new Date().toISOString();
        }

        // Store in localStorage
        localStorage.setItem(
            STORAGE_KEYS.CURRENT_ASSESSMENT,
            JSON.stringify(assessmentData)
        );

        return true;
    } catch (error) {
        console.error('Error saving current assessment:', error);
        return false;
    }
}

/**
 * Retrieves the current in-progress assessment
 * @returns {Object|null} - Assessment data or null if none exists
 */
function getCurrentAssessment() {
    try {
        const data = localStorage.getItem(STORAGE_KEYS.CURRENT_ASSESSMENT);
        return data ? JSON.parse(data) : null;
    } catch (error) {
        console.error('Error retrieving current assessment:', error);
        return null;
    }
}

/**
 * Clears the current in-progress assessment
 * @returns {boolean} - Success status
 */
function clearCurrentAssessment() {
    try {
        localStorage.removeItem(STORAGE_KEYS.CURRENT_ASSESSMENT);
        return true;
    } catch (error) {
        console.error('Error clearing current assessment:', error);
        return false;
    }
}

/**
 * Saves a completed assessment with results
 * @param {Object} assessmentData - Complete assessment data
 * @param {Object} assessmentData.responses - User responses
 * @param {Object} assessmentData.rawScores - Raw scores for each scale
 * @param {Object} assessmentData.tScores - T-scores for each scale
 * @param {Object} assessmentData.interpretations - Score interpretations
 * @param {string} assessmentData.summary - Summary report
 * @param {Date} assessmentData.completedDate - Completion timestamp
 * @returns {string|null} - ID of saved assessment or null if failed
 */
function saveCompletedAssessment(assessmentData) {
    try {
        // Generate unique ID for this assessment
        const assessmentId = 'assessment_' + Date.now();

        // Add metadata
        const assessmentWithMetadata = {
            ...assessmentData,
            id: assessmentId,
            completedDate: assessmentData.completedDate || new Date().toISOString(),
            version: '1.0'
        };

        // Get existing saved assessments
        let savedAssessments = getSavedAssessments();
        if (!savedAssessments) {
            savedAssessments = {};
        }

        // Add new assessment
        savedAssessments[assessmentId] = assessmentWithMetadata;

        // Save back to localStorage
        localStorage.setItem(
            STORAGE_KEYS.SAVED_ASSESSMENTS,
            JSON.stringify(savedAssessments)
        );

        return assessmentId;
    } catch (error) {
        console.error('Error saving completed assessment:', error);
        return null;
    }
}

/**
 * Retrieves all saved assessments
 * @returns {Object|null} - Object with assessment IDs as keys and assessment data as values
 */
function getSavedAssessments() {
    try {
        const data = localStorage.getItem(STORAGE_KEYS.SAVED_ASSESSMENTS);
        return data ? JSON.parse(data) : {};
    } catch (error) {
        console.error('Error retrieving saved assessments:', error);
        return null;
    }
}

/**
 * Retrieves a specific saved assessment by ID
 * @param {string} assessmentId - ID of the assessment to retrieve
 * @returns {Object|null} - Assessment data or null if not found
 */
function getSavedAssessment(assessmentId) {
    try {
        const savedAssessments = getSavedAssessments();
        return savedAssessments && savedAssessments[assessmentId] ?
            savedAssessments[assessmentId] :
            null;
    } catch (error) {
        console.error(`Error retrieving assessment ${assessmentId}:`, error);
        return null;
    }
}

/**
 * Deletes a saved assessment
 * @param {string} assessmentId - ID of the assessment to delete
 * @returns {boolean} - Success status
 */
function deleteSavedAssessment(assessmentId) {
    try {
        const savedAssessments = getSavedAssessments();
        if (!savedAssessments || !savedAssessments[assessmentId]) {
            return false;
        }

        // Remove the assessment
        delete savedAssessments[assessmentId];

        // Save back to localStorage
        localStorage.setItem(
            STORAGE_KEYS.SAVED_ASSESSMENTS,
            JSON.stringify(savedAssessments)
        );

        return true;
    } catch (error) {
        console.error(`Error deleting assessment ${assessmentId}:`, error);
        return false;
    }
}

/**
 * Checks if localStorage is available in the browser
 * @returns {boolean} - True if localStorage is available
 */
function isStorageAvailable() {
    try {
        const test = '__storage_test__';
        localStorage.setItem(test, test);
        localStorage.removeItem(test);
        return true;
    } catch (e) {
        return false;
    }
}

/**
 * Exports assessment data as a JSON file for download
 * @param {string} assessmentId - ID of the assessment to export
 * @returns {boolean} - Success status
 */
function exportAssessment(assessmentId) {
    try {
        const assessment = getSavedAssessment(assessmentId);
        if (!assessment) {
            return false;
        }

        // Create a Blob with the JSON data
        const blob = new Blob(
            [JSON.stringify(assessment, null, 2)], {
                type: 'application/json'
            }
        );

        // Create download link
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `mmpi_assessment_${assessmentId}.json`;

        // Trigger download
        document.body.appendChild(a);
        a.click();

        // Cleanup
        setTimeout(() => {
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }, 0);

        return true;
    } catch (error) {
        console.error(`Error exporting assessment ${assessmentId}:`, error);
        return false;
    }
}

/**
 * Imports assessment data from a JSON file
 * @param {File} file - JSON file to import
 * @returns {Promise<string|null>} - Promise resolving to assessment ID or null if failed
 */
function importAssessment(file) {
    return new Promise((resolve, reject) => {
        try {
            const reader = new FileReader();

            reader.onload = (event) => {
                try {
                    const assessmentData = JSON.parse(event.target.result);

                    // Validate the data structure
                    if (!assessmentData.responses || !assessmentData.tScores) {
                        reject(new Error('Invalid assessment data format'));
                        return;
                    }

                    // Generate new ID to avoid conflicts
                    const assessmentId = 'assessment_' + Date.now();
                    assessmentData.id = assessmentId;

                    // Save the imported assessment
                    const savedAssessments = getSavedAssessments() || {};
                    savedAssessments[assessmentId] = assessmentData;

                    localStorage.setItem(
                        STORAGE_KEYS.SAVED_ASSESSMENTS,
                        JSON.stringify(savedAssessments)
                    );

                    resolve(assessmentId);
                } catch (error) {
                    reject(error);
                }
            };

            reader.onerror = () => {
                reject(new Error('Error reading file'));
            };

            reader.readAsText(file);
        } catch (error) {
            reject(error);
        }
    });
}

/**
 * Saves user settings
 * @param {Object} settings - User settings
 * @returns {boolean} - Success status
 */
function saveSettings(settings) {
    try {
        localStorage.setItem(
            STORAGE_KEYS.SETTINGS,
            JSON.stringify(settings)
        );
        return true;
    } catch (error) {
        console.error('Error saving settings:', error);
        return false;
    }
}

/**
 * Retrieves user settings
 * @returns {Object|null} - User settings or default settings if none exist
 */
function getSettings() {
    try {
        const data = localStorage.getItem(STORAGE_KEYS.SETTINGS);
        return data ? JSON.parse(data) : getDefaultSettings();
    } catch (error) {
        console.error('Error retrieving settings:', error);
        return getDefaultSettings();
    }
}

/**
 * Returns default settings
 * @returns {Object} - Default settings
 */
function getDefaultSettings() {
    return {
        darkMode: false,
        fontSize: 'medium',
        highContrast: false,
        saveResponses: true
    };
}

// Export the functions for use in other modules
if (typeof module !== 'undefined' && module.exports) {
    module.exports = {
        saveCurrentAssessment,
        getCurrentAssessment,
        clearCurrentAssessment,
        saveCompletedAssessment,
        getSavedAssessments,
        getSavedAssessment,
        deleteSavedAssessment,
        isStorageAvailable,
        exportAssessment,
        importAssessment,
        saveSettings,
        getSettings
    };
}/**
 * MMPI-II-RF Charts Module
 * 
 * This module handles the visualization of MMPI-II-RF assessment results
 * using Chart.js for creating interactive and accessible charts.
 */

/**
 * Creates a T-score profile chart for a set of scales
 * @param {string} canvasId - ID of the canvas element to render the chart
 * @param {Object} tScores - Object with scale IDs as keys and T-scores as values
 * @param {Object} scaleDefinitions - Object with scale definitions
 * @param {string} scaleType - Type of scales to include (e.g., "validity", "clinical")
 * @returns {Object|null} - Chart instance or null if failed
 */
function createTScoreProfileChart(canvasId, tScores, scaleDefinitions, scaleType) {
    try {
        const canvas = document.getElementById(canvasId);
        if (!canvas) {
            console.error(`Canvas element with ID ${canvasId} not found`);
            return null;
        }

        // Filter scales by type
        const relevantScales = Object.entries(scaleDefinitions)
            .filter(([_, scale]) => scale.type === scaleType)
            .map(([scaleId, _]) => scaleId);

        // Prepare data
        const labels = relevantScales.map(scaleId => scaleId);
        const data = relevantScales.map(scaleId => tScores[scaleId] || 0);

        // Define clinical significance zones
        const clinicalCutoff = 65;
        const borderlineCutoff = 55;

        // Create chart
        return new Chart(canvas, {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [{
                    label: 'T-Score',
                    data: data,
                    backgroundColor: data.map(value => {
                        if (value >= clinicalCutoff) return 'rgba(231, 76, 60, 0.7)'; // Red for clinical
                        if (value >= borderlineCutoff) return 'rgba(241, 196, 15, 0.7)'; // Yellow for borderline
                        return 'rgba(52, 152, 219, 0.7)'; // Blue for normal
                    }),
                    borderColor: data.map(value => {
                        if (value >= clinicalCutoff) return 'rgb(192, 57, 43)';
                        if (value >= borderlineCutoff) return 'rgb(243, 156, 18)';
                        return 'rgb(41, 128, 185)';
                    }),
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: false,
                        min: 30,
                        max: 90,
                        title: {
                            display: true,
                            text: 'T-Score'
                        },
                        grid: {
                            color: (context) => {
                                if (context.tick.value === clinicalCutoff) return 'rgba(231, 76, 60, 0.5)';
                                if (context.tick.value === borderlineCutoff) return 'rgba(241, 196, 15, 0.5)';
                                if (context.tick.value === 50) return 'rgba(0, 0, 0, 0.1)';
                                return 'rgba(0, 0, 0, 0.05)';
                            },
                            lineWidth: (context) => {
                                if ([clinicalCutoff, borderlineCutoff, 50].includes(context.tick.value)) return 2;
                                return 1;
                            }
                        }
                    },
                    x: {
                        title: {
                            display: true,
                            text: 'Scales'
                        }
                    }
                },
                plugins: {
                    tooltip: {
                        callbacks: {
                            title: (tooltipItems) => {
                                const scaleId = tooltipItems[0].label;
                                const scale = scaleDefinitions[scaleId];
                                return scale ? `${scaleId}: ${scale.name}` : scaleId;
                            },
                            afterLabel: (tooltipItem) => {
                                const scaleId = tooltipItem.label;
                                const scale = scaleDefinitions[scaleId];
                                return scale ? scale.description : '';
                            },
                            footer: (tooltipItems) => {
                                const value = tooltipItems[0].parsed.y;
                                if (value >= clinicalCutoff) {
                                    return 'Clinical Significance: High';
                                } else if (value >= borderlineCutoff) {
                                    return 'Clinical Significance: Moderate';
                                } else {
                                    return 'Clinical Significance: Low';
                                }
                            }
                        }
                    },
                    legend: {
                        display: false
                    },
                    annotation: {
                        annotations: {
                            clinicalLine: {
                                type: 'line',
                                yMin: clinicalCutoff,
                                yMax: clinicalCutoff,
                                borderColor: 'rgba(231, 76, 60, 0.5)',
                                borderWidth: 2,
                                label: {
                                    enabled: true,
                                    content: 'Clinical Cutoff',
                                    position: 'end'
                                }
                            },
                            borderlineLine: {
                                type: 'line',
                                yMin: borderlineCutoff,
                                yMax: borderlineCutoff,
                                borderColor: 'rgba(241, 196, 15, 0.5)',
                                borderWidth: 2,
                                label: {
                                    enabled: true,
                                    content: 'Borderline',
                                    position: 'end'
                                }
                            },
                            meanLine: {
                                type: 'line',
                                yMin: 50,
                                yMax: 50,
                                borderColor: 'rgba(0, 0, 0, 0.3)',
                                borderWidth: 1,
                                borderDash: [6, 4],
                                label: {
                                    enabled: true,
                                    content: 'Mean',
                                    position: 'end'
                                }
                            }
                        }
                    }
                },
                // Accessibility features
                accessibility: {
                    enabled: true,
                    description: `T-score profile chart for MMPI-II-RF ${scaleType} scales`
                }
            }
        });
    } catch (error) {
        console.error('Error creating T-score profile chart:', error);
        return null;
    }
}

/**
 * Creates a radar chart showing the profile across multiple scale categories
 * @param {string} canvasId - ID of the canvas element to render the chart
 * @param {Object} tScores - Object with scale IDs as keys and T-scores as values
 * @param {Object} scaleDefinitions - Object with scale definitions
 * @returns {Object|null} - Chart instance or null if failed
 */
function createProfileRadarChart(canvasId, tScores, scaleDefinitions) {
    try {
        const canvas = document.getElementById(canvasId);
        if (!canvas) {
            console.error(`Canvas element with ID ${canvasId} not found`);
            return null;
        }

        // Select key scales for the radar chart
        const keyScales = [
            'EID', 'THD', 'BXD', // Higher-Order scales
            'RCd', 'RC1', 'RC2', 'RC3', 'RC4', 'RC6', 'RC7', 'RC8', 'RC9' // RC scales
        ];

        // Prepare data
        const labels = keyScales.map(scaleId => {
            const scale = scaleDefinitions[scaleId];
            return scale ? `${scaleId}: ${scale.name.split(' ')[0]}` : scaleId;
        });

        const data = keyScales.map(scaleId => tScores[scaleId] || 0);

        // Create chart
        return new Chart(canvas, {
            type: 'radar',
            data: {
                labels: labels,
                datasets: [{
                    label: 'T-Score Profile',
                    data: data,
                    backgroundColor: 'rgba(52, 152, 219, 0.2)',
                    borderColor: 'rgba(52, 152, 219, 1)',
                    pointBackgroundColor: 'rgba(52, 152, 219, 1)',
                    pointBorderColor: '#fff',
                    pointHoverBackgroundColor: '#fff',
                    pointHoverBorderColor: 'rgba(52, 152, 219, 1)'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    r: {
                        angleLines: {
                            display: true
                        },
                        suggestedMin: 30,
                        suggestedMax: 90,
                        ticks: {
                            stepSize: 10
                        },
                        pointLabels: {
                            font: {
                                size: 12
                            }
                        }
                    }
                },
                plugins: {
                    tooltip: {
                        callbacks: {
                            title: (tooltipItems) => {
                                const index = tooltipItems[0].dataIndex;
                                const scaleId = keyScales[index];
                                const scale = scaleDefinitions[scaleId];
                                return scale ? `${scaleId}: ${scale.name}` : scaleId;
                            },
                            afterLabel: (tooltipItem) => {
                                const index = tooltipItem.dataIndex;
                                const scaleId = keyScales[index];
                                const scale = scaleDefinitions[scaleId];
                                return scale ? scale.description : '';
                            }
                        }
                    },
                    legend: {
                        display: false
                    }
                },
                // Accessibility features
                accessibility: {
                    enabled: true,
                    description: 'Radar chart showing MMPI-II-RF profile across key scales'
                }
            }
        });
    } catch (error) {
        console.error('Error creating profile radar chart:', error);
        return null;
    }
}

/**
 * Creates a horizontal bar chart for comparing scale elevations
 * @param {string} canvasId - ID of the canvas element to render the chart
 * @param {Object} interpretations - Object with scale interpretations
 * @param {Object} scaleDefinitions - Object with scale definitions
 * @returns {Object|null} - Chart instance or null if failed
 */
function createElevationComparisonChart(canvasId, interpretations, scaleDefinitions) {
    try {
        const canvas = document.getElementById(canvasId);
        if (!canvas) {
            console.error(`Canvas element with ID ${canvasId} not found`);
            return null;
        }

        // Get scales with elevated scores (T >= 65)
        const elevatedScales = Object.entries(interpretations)
            .filter(([_, interp]) => interp.score >= 65)
            .sort((a, b) => b[1].score - a[1].score) // Sort by score descending
            .slice(0, 10); // Take top 10

        if (elevatedScales.length === 0) {
            // If no elevated scales, show message on canvas
            const ctx = canvas.getContext('2d');
            ctx.font = '16px Arial';
            ctx.fillStyle = '#666';
            ctx.textAlign = 'center';
            ctx.fillText('No clinically significant elevations found', canvas.width / 2, canvas.height / 2);
            return null;
        }

        // Prepare data
        const labels = elevatedScales.map(([scaleId, _]) => {
            const scale = scaleDefinitions[scaleId];
            return scale ? `${scaleId}: ${scale.name}` : scaleId;
        });

        const data = elevatedScales.map(([_, interp]) => interp.score);

        // Create chart
        return new Chart(canvas, {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [{
                    axis: 'y',
                    label: 'T-Score',
                    data: data,
                    backgroundColor: data.map(value => {
                        if (value >= 75) return 'rgba(192, 57, 43, 0.7)'; // Dark red for very high
                        return 'rgba(231, 76, 60, 0.7)'; // Red for high
                    }),
                    borderColor: data.map(value => {
                        if (value >= 75) return 'rgb(146, 43, 33)';
                        return 'rgb(192, 57, 43)';
                    }),
                    borderWidth: 1
                }]
            },
            options: {
                indexAxis: 'y',
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        beginAtZero: false,
                        min: 50,
                        max: 90,
                        title: {
                            display: true,
                            text: 'T-Score'
                        }
                    }
                },
                plugins: {
                    title: {
                        display: true,
                        text: 'Clinically Significant Elevations'
                    },
                    tooltip: {
                        callbacks: {
                            afterLabel: (tooltipItem) => {
                                const scaleId = elevatedScales[tooltipItem.dataIndex][0];
                                const scale = scaleDefinitions[scaleId];
                                return scale ? scale.description : '';
                            }
                        }
                    }
                },
                // Accessibility features
                accessibility: {
                    enabled: true,
                    description: 'Bar chart showing clinically significant elevations in MMPI-II-RF scales'
                }
            }
        });
    } catch (error) {
        console.error('Error creating elevation comparison chart:', error);
        return null;
    }
}

/**
 * Initializes all charts for the results page
 * @param {Object} tScores - Object with scale IDs as keys and T-scores as values
 * @param {Object} interpretations - Object with scale interpretations
 * @param {Object} scaleDefinitions - Object with scale definitions
 */
function initializeResultCharts(tScores, interpretations, scaleDefinitions) {
    // Create charts for each scale category
    createTScoreProfileChart('validity-scales-chart', tScores, scaleDefinitions, 'validity');
    createTScoreProfileChart('ho-scales-chart', tScores, scaleDefinitions, 'higher-order');
    createTScoreProfileChart('rc-scales-chart', tScores, scaleDefinitions, 'clinical');
    createTScoreProfileChart('sp-scales-chart', tScores, scaleDefinitions, 'problem');
    createTScoreProfileChart('interest-scales-chart', tScores, scaleDefinitions, 'interest');

    // Create summary charts
    createProfileRadarChart('profile-radar-chart', tScores, scaleDefinitions);
    createElevationComparisonChart('elevation-chart', interpretations, scaleDefinitions);
}

/**
 * Creates a printable version of all charts
 * @param {Object} tScores - Object with scale IDs as keys and T-scores as values
 * @param {Object} interpretations - Object with scale interpretations
 * @param {Object} scaleDefinitions - Object with scale definitions
 * @returns {string} - HTML string with printable charts
 */
function createPrintableCharts(tScores, interpretations, scaleDefinitions) {
    // This would generate static images of charts for printing
    // For now, we'll return a placeholder
    return `
    <div class="print-charts">
      <h3>MMPI-II-RF Profile Charts</h3>
      <p>Charts would be rendered here for printing</p>
    </div>
  `;
}

// Export the functions for use in other modules
if (typeof module !== 'undefined' && module.exports) {
    module.exports = {
        createTScoreProfileChart,
        createProfileRadarChart,
        createElevationComparisonChart,
        initializeResultCharts,
        createPrintableCharts
    };
}/**
 * MMPI-II-RF Assessment Application
 * 
 * Main application script that coordinates the assessment process,
 * handles user interactions, and manages the application state.
 */

// Global state
const appState = {
    currentSection: 'introduction',
    currentQuestionIndex: 0,
    responses: {},
    results: null,
    charts: {}
};

// DOM elements
const elements = {
    sections: {
        introduction: document.getElementById('introduction'),
        assessment: document.getElementById('assessment'),
        results: document.getElementById('results')
    },
    buttons: {
        startAssessment: document.getElementById('start-assessment'),
        prevQuestion: document.getElementById('prev-question'),
        nextQuestion: document.getElementById('next-question'),
        saveProgress: document.getElementById('save-progress'),
        printResults: document.getElementById('print-results'),
        exportResults: document.getElementById('export-results'),
        saveResults: document.getElementById('save-results'),
        restartAssessment: document.getElementById('restart-assessment')
    },
    assessment: {
        progressIndicator: document.getElementById('progress-indicator'),
        currentQuestionDisplay: document.getElementById('current-question'),
        totalQuestionsDisplay: document.getElementById('total-questions'),
        questionText: document.getElementById('question-text'),
        optionButtons: document.querySelectorAll('.option-btn')
    },
    results: {
        validityScalesChart: document.getElementById('validity-scales-chart'),
        hoScalesChart: document.getElementById('ho-scales-chart'),
        rcScalesChart: document.getElementById('rc-scales-chart'),
        spScalesChart: document.getElementById('sp-scales-chart'),
        interestScalesChart: document.getElementById('interest-scales-chart'),
        validityScalesInterpretation: document.getElementById('validity-scales-interpretation'),
        hoScalesInterpretation: document.getElementById('ho-scales-interpretation'),
        rcScalesInterpretation: document.getElementById('rc-scales-interpretation'),
        spScalesInterpretation: document.getElementById('sp-scales-interpretation'),
        interestScalesInterpretation: document.getElementById('interest-scales-interpretation'),
        resultsSummaryContent: document.getElementById('results-summary-content')
    }
};

/**
 * Initializes the application
 */
function initializeApp() {
    // Set up event listeners
    setupEventListeners();

    // Check for saved assessment
    checkForSavedAssessment();

    // Update total questions display
    if (elements.assessment.totalQuestionsDisplay) {
        elements.assessment.totalQuestionsDisplay.textContent = mmpiQuestions.length;
    }

    // Load user settings
    loadUserSettings();

    console.log('MMPI-II-RF Assessment Application initialized');
}

/**
 * Sets up event listeners for user interactions
 */
function setupEventListeners() {
    // Start assessment button
    if (elements.buttons.startAssessment) {
        elements.buttons.startAssessment.addEventListener('click', startAssessment);
    }

    // Navigation buttons
    if (elements.buttons.prevQuestion) {
        elements.buttons.prevQuestion.addEventListener('click', showPreviousQuestion);
    }

    if (elements.buttons.nextQuestion) {
        elements.buttons.nextQuestion.addEventListener('click', handleNextQuestion);
    }

    // Save progress button
    if (elements.buttons.saveProgress) {
        elements.buttons.saveProgress.addEventListener('click', saveAssessmentProgress);
    }

    // Results action buttons
    if (elements.buttons.printResults) {
        elements.buttons.printResults.addEventListener('click', printResults);
    }

    if (elements.buttons.exportResults) {
        elements.buttons.exportResults.addEventListener('click', exportResultsAsPDF);
    }

    if (elements.buttons.saveResults) {
        elements.buttons.saveResults.addEventListener('click', saveResults);
    }

    if (elements.buttons.restartAssessment) {
        elements.buttons.restartAssessment.addEventListener('click', restartAssessment);
    }

    // Option buttons
    elements.assessment.optionButtons.forEach(button => {
        button.addEventListener('click', (e) => {
            selectOption(e.target);
        });
    });

    // Keyboard navigation
    document.addEventListener('keydown', handleKeyboardNavigation);
}

/**
 * Checks for a saved assessment in local storage
 */
function checkForSavedAssessment() {
    if (!isStorageAvailable()) {
        console.warn('Local storage is not available');
        return;
    }

    const savedAssessment = getCurrentAssessment();
    if (savedAssessment && savedAssessment.responses) {
        // Show resume option
        const resumeContainer = document.createElement('div');
        resumeContainer.className = 'resume-container';
        resumeContainer.innerHTML = `
      <div class="info-box">
        <h3>Resume Previous Assessment</h3>
        <p>You have an unfinished assessment. Would you like to resume where you left off?</p>
        <button id="resume-assessment" class="btn btn-primary">Resume Assessment</button>
        <button id="discard-assessment" class="btn btn-secondary">Start New Assessment</button>
      </div>
    `;

        elements.sections.introduction.insertBefore(
            resumeContainer,
            elements.buttons.startAssessment.parentNode
        );

        // Hide the regular start button
        elements.buttons.startAssessment.style.display = 'none';

        // Add event listeners for resume buttons
        document.getElementById('resume-assessment').addEventListener('click', () => {
            resumeAssessment(savedAssessment);
        });

        document.getElementById('discard-assessment').addEventListener('click', () => {
            clearCurrentAssessment();
            resumeContainer.remove();
            elements.buttons.startAssessment.style.display = 'block';
        });
    }
}

/**
 * Loads user settings from local storage
 */
function loadUserSettings() {
    if (!isStorageAvailable()) {
        return;
    }

    const settings = getSettings();

    // Apply settings
    if (settings.darkMode) {
        document.body.classList.add('dark-mode');
    }

    if (settings.highContrast) {
        document.body.classList.add('high-contrast');
    }

    document.body.classList.add(`font-size-${settings.fontSize}`);
}

/**
 * Starts a new assessment
 */
function startAssessment() {
    // Switch to assessment section
    showSection('assessment');

    // Reset state
    appState.currentQuestionIndex = 0;
    appState.responses = {};

    // Show first question
    showCurrentQuestion();
}

/**
 * Resumes a saved assessment
 * @param {Object} savedAssessment - Saved assessment data
 */
function resumeAssessment(savedAssessment) {
    // Switch to assessment section
    showSection('assessment');

    // Restore state
    appState.currentQuestionIndex = savedAssessment.currentQuestion || 0;
    appState.responses = savedAssessment.responses || {};

    // Show current question
    showCurrentQuestion();
}

/**
 * Shows the current question
 */
function showCurrentQuestion() {
    const question = mmpiQuestions[appState.currentQuestionIndex];
    if (!question) {
        console.error('Question not found');
        return;
    }

    // Update question text
    elements.assessment.questionText.textContent = question.text;

    // Update question number display
    elements.assessment.currentQuestionDisplay.textContent = appState.currentQuestionIndex + 1;

    // Update progress bar
    const progressPercentage = ((appState.currentQuestionIndex + 1) / mmpiQuestions.length) * 100;
    elements.assessment.progressIndicator.style.width = `${progressPercentage}%`;

    // Update option buttons
    const currentResponse = appState.responses[question.id];
    elements.assessment.optionButtons.forEach(button => {
        const value = button.getAttribute('data-value') === 'true';
        button.classList.toggle('selected', currentResponse === value);
    });

    // Update navigation buttons
    elements.buttons.prevQuestion.disabled = appState.currentQuestionIndex === 0;

    // If this is the last question, change "Next" to "Finish"
    if (appState.currentQuestionIndex === mmpiQuestions.length - 1) {
        elements.buttons.nextQuestion.textContent = 'Finish Assessment';
    } else {
        elements.buttons.nextQuestion.textContent = 'Next';
    }
}

/**
 * Shows the previous question
 */
function showPreviousQuestion() {
    if (appState.currentQuestionIndex > 0) {
        appState.currentQuestionIndex--;
        showCurrentQuestion();
    }
}

/**
 * Handles the next question button click
 */
function handleNextQuestion() {
    const question = mmpiQuestions[appState.currentQuestionIndex];

    // Check if current question is answered
    if (appState.responses[question.id] === undefined) {
        // Show warning
        alert('Please answer the current question before proceeding.');
        return;
    }

    // If this is the last question, complete the assessment
    if (appState.currentQuestionIndex === mmpiQuestions.length - 1) {
        completeAssessment();
        return;
    }

    // Otherwise, go to next question
    appState.currentQuestionIndex++;
    showCurrentQuestion();

    // Save progress automatically
    if (isStorageAvailable() && getSettings().saveResponses) {
        saveAssessmentProgress(false); // Don't show confirmation
    }
}

/**
 * Selects an option for the current question
 * @param {HTMLElement} selectedButton - The selected option button
 */
function selectOption(selectedButton) {
    const question = mmpiQuestions[appState.currentQuestionIndex];
    const value = selectedButton.getAttribute('data-value') === 'true';

    // Update response
    appState.responses[question.id] = value;

    // Update UI
    elements.assessment.optionButtons.forEach(button => {
        button.classList.toggle('selected', button === selectedButton);
    });
}

/**
 * Handles keyboard navigation
 * @param {KeyboardEvent} event - Keyboard event
 */
function handleKeyboardNavigation(event) {
    // Only handle keyboard navigation when in assessment section
    if (appState.currentSection !== 'assessment') {
        return;
    }

    switch (event.key) {
        case 'ArrowLeft':
            showPreviousQuestion();
            break;
        case 'ArrowRight':
            handleNextQuestion();
            break;
        case 't':
        case 'T':
            // Select "True" option
            selectOption(elements.assessment.optionButtons[0]);
            break;
        case 'f':
        case 'F':
            // Select "False" option
            selectOption(elements.assessment.optionButtons[1]);
            break;
    }
}

/**
 * Saves the current assessment progress
 * @param {boolean} showConfirmation - Whether to show a confirmation message
 */
function saveAssessmentProgress(showConfirmation = true) {
    if (!isStorageAvailable()) {
        alert('Local storage is not available. Your progress cannot be saved.');
        return;
    }

    const assessmentData = {
        responses: appState.responses,
        currentQuestion: appState.currentQuestionIndex,
        lastUpdated: new Date().toISOString()
    };

    const success = saveCurrentAssessment(assessmentData);

    if (success && showConfirmation) {
        alert('Your progress has been saved. You can resume this assessment later.');
    }
}

/**
 * Completes the assessment and shows results
 */
function completeAssessment() {
    // Calculate scores
    const rawScores = calculateRawScores(appState.responses);
    const tScores = convertToTScores(rawScores, 'general'); // Using general norms
    const interpretations = interpretScores(tScores);

    // Store results
    appState.results = {
        responses: appState.responses,
        rawScores,
        tScores,
        interpretations,
        completedDate: new Date().toISOString()
    };

    // Generate summary report
    const summaryReport = generateSummaryReport(interpretations);

    // Switch to results section
    showSection('results');

    // Display results
    displayResults(appState.results, summaryReport);

    // Clear saved in-progress assessment
    if (isStorageAvailable()) {
        clearCurrentAssessment();
    }
}

/**
 * Displays assessment results
 * @param {Object} results - Assessment results
 * @param {string} summaryReport - Summary report text
 */
function displayResults(results, summaryReport) {
    // Display interpretations
    displayInterpretations(results.interpretations);

    // Display summary
    elements.results.resultsSummaryContent.innerHTML = marked.parse(summaryReport);

    // Initialize charts
    initializeResultCharts(results.tScores, results.interpretations, mmpiScales);
}

/**
 * Displays scale interpretations
 * @param {Object} interpretations - Scale interpretations
 */
function displayInterpretations(interpretations) {
    // Group interpretations by scale type
    const groupedInterpretations = {
        validity: {},
        'higher-order': {},
        clinical: {},
        problem: {},
        interest: {}
    };

    // Group interpretations
    for (const [scaleId, interpretation] of Object.entries(interpretations)) {
        const scale = mmpiScales[scaleId];
        if (scale && scale.type) {
            if (groupedInterpretations[scale.type]) {
                groupedInterpretations[scale.type][scaleId] = interpretation;
            }
        }
    }

    // Display each group
    displayScaleGroupInterpretation(
        groupedInterpretations.validity,
        elements.results.validityScalesInterpretation,
        'Validity Scales'
    );

    displayScaleGroupInterpretation(
        groupedInterpretations['higher-order'],
        elements.results.hoScalesInterpretation,
        'Higher-Order Scales'
    );

    displayScaleGroupInterpretation(
        groupedInterpretations.clinical,
        elements.results.rcScalesInterpretation,
        'Restructured Clinical Scales'
    );

    displayScaleGroupInterpretation(
        groupedInterpretations.problem,
        elements.results.spScalesInterpretation,
        'Specific Problem Scales'
    );

    displayScaleGroupInterpretation(
        groupedInterpretations.interest,
        elements.results.interestScalesInterpretation,
        'Interest Scales'
    );
}

/**
 * Displays interpretation for a group of scales
 * @param {Object} interpretations - Interpretations for the scale group
 * @param {HTMLElement} container - Container element to display the interpretation
 * @param {string} groupTitle - Title of the scale group
 */
function displayScaleGroupInterpretation(interpretations, container, groupTitle) {
    if (!container) return;

    let html = `<h4>${groupTitle} Interpretation</h4>`;

    // Check if there are any interpretations
    if (Object.keys(interpretations).length === 0) {
        html += `<p>No data available for ${groupTitle}.</p>`;
        container.innerHTML = html;
        return;
    }

    // Add interpretations
    html += '<ul>';
    for (const [scaleId, interpretation] of Object.entries(interpretations)) {
        const scale = mmpiScales[scaleId];
        const scaleName = scale ? scale.name : scaleId;

        html += `
      <li>
        <strong>${scaleId}: ${scaleName}</strong> - 
        T-Score: ${interpretation.score} (${interpretation.level})
        <p>${interpretation.description}</p>
      </li>
    `;
    }
    html += '</ul>';

    container.innerHTML = html;
}

/**
 * Prints the assessment results
 */
function printResults() {
    window.print();
}

/**
 * Exports the assessment results as a PDF
 */
function exportResultsAsPDF() {
    // In a real implementation, this would use a library like jsPDF
    // For now, we'll just show an alert
    alert('This feature would export the results as a PDF file.');

    // Example of how this might be implemented:
    /*
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
  
    // Add content to PDF
    doc.text('MMPI-II-RF Assessment Results', 20, 20);
    // ... add more content ...
  
    // Save the PDF
    doc.save('mmpi_assessment_results.pdf');
    */
}

/**
 * Saves the assessment results to local storage
 */
function saveResults() {
    if (!isStorageAvailable()) {
        alert('Local storage is not available. Your results cannot be saved.');
        return;
    }

    if (!appState.results) {
        alert('No results to save.');
        return;
    }

    const assessmentId = saveCompletedAssessment(appState.results);

    if (assessmentId) {
        alert('Your assessment results have been saved. You can access them from the saved assessments page.');
    } else {
        alert('Failed to save assessment results.');
    }
}

/**
 * Restarts the assessment
 */
function restartAssessment() {
    // Confirm restart
    if (confirm('Are you sure you want to start a new assessment? This will clear your current results.')) {
        // Reset state
        appState.currentQuestionIndex = 0;
        appState.responses = {};
        appState.results = null;

        // Go back to introduction
        showSection('introduction');
    }
}

/**
 * Shows a specific section and hides others
 * @param {string} sectionId - ID of the section to show
 */
function showSection(sectionId) {
    // Update state
    appState.currentSection = sectionId;

    // Update UI
    for (const [id, section] of Object.entries(elements.sections)) {
        if (section) {
            section.classList.toggle('active-section', id === sectionId);
            section.classList.toggle('hidden-section', id !== sectionId);
        }
    }

    // Scroll to top
    window.scrollTo(0, 0);
}

// Initialize the application when the DOM is fully loaded
document.addEventListener('DOMContentLoaded', initializeApp);

// Add a polyfill for marked if it's not available
if (typeof marked === 'undefined') {
    window.marked = {
        parse: function(text) {
            // Simple markdown parsing for headings and lists
            return text
                .replace(/^## (.*$)/gm, '<h2>$1</h2>')
                .replace(/^### (.*$)/gm, '<h3>$1</h3>')
                .replace(/^- (.*$)/gm, '<li>$1</li>')
                .replace(/^\n\n/gm, '</ul><ul>')
                .replace(/^\* (.*$)/gm, '<li>$1</li>');
        }
    };
}
